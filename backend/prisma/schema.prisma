generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
}

model User {
  id        Int      @id @default(autoincrement())
  email     String   @unique
  password  String
  firstName String
  lastName  String
  role      String   @default("employee")
  department String?
  isActive          Boolean   @default(true)
  lastLogin         DateTime?
  passwordChangedAt DateTime?
  createdAt         DateTime  @default(now())
  updatedAt         DateTime  @updatedAt

  requests      MovementRequest[]
  approvals     Approval[]
  notifications Notification[]

  @@map("users")
}

model MovementRequest {
  id           Int      @id @default(autoincrement())
  title        String
  department   String
  priority     String   @default("medium")
  status       String   @default("pending")
  neededBy     DateTime
  fromLocation String
  toLocation   String
  purpose      String   @db.Text
  totalAmount  Float    @default(0)
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt
  userId       Int

  user      User           @relation(fields: [userId], references: [id], onDelete: Cascade)
  items     RequestItem[]
  approvals Approval[]
  files     File[]

  @@map("movement_requests")
}

model RequestItem {
  id            Int     @id @default(autoincrement())
  name          String
  category      String
  quantity      Int
  unit          String
  estimatedCost Float
  requestId     Int

  request MovementRequest @relation(fields: [requestId], references: [id], onDelete: Cascade)

  @@map("request_items")
}

model Approval {
  id        Int      @id @default(autoincrement())
  status    String   @default("pending")
  comments  String?
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  requestId Int
  approverId Int

  request  MovementRequest @relation(fields: [requestId], references: [id], onDelete: Cascade)
  approver User            @relation(fields: [approverId], references: [id])

  @@map("approvals")
}

model Notification {
  id        Int      @id @default(autoincrement())
  title     String
  message   String
  type      String   @default("info")
  isRead    Boolean  @default(false)
  createdAt DateTime @default(now())
  userId    Int

  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@map("notifications")
}

model Category {
  id          Int      @id @default(autoincrement())
  name        String   @unique
  description String?
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  @@map("categories")
}

model Department {
  id          Int      @id @default(autoincrement())
  name        String   @unique
  description String?
  budget      Float?
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  @@map("departments")
}

model File {
  id        Int      @id @default(autoincrement())
  filename  String
  path      String
  mimetype  String
  size      Int
  createdAt DateTime @default(now())
  requestId Int?

  request MovementRequest? @relation(fields: [requestId], references: [id], onDelete: Cascade)

  @@map("files")
}
